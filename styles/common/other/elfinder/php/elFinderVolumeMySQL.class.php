<?php
class elFinderVolumeMySQL extends elFinderVolumeDriver {protected $driverId = 'm';protected $db;protected $tbf = '';protected $accessControl;protected $tmpPath = '';protected $cache = [];protected $paths = [];protected $sqlCnt = 0;public function __construct() {$veb4112b6a6b76c8a84808a40baa94769 = [   'host'          => 'localhost',   'user'          => '',   'pass'          => '',   'db'            => '',   'port'          => null,   'socket'        => null,   'files_table'   => 'elfinder_file',   'tmbPath'       => '',   'tmpPath'       => ''  ];$this->options = array_merge($this->options, $veb4112b6a6b76c8a84808a40baa94769);}protected function init() {if (!$this->options['host']   ||  !$this->options['user']   ||  !$this->options['pass']   ||  !$this->options['db']  ||  !$this->options['path']) {return false;}$this->db = new mysqli($this->options['host'], $this->options['user'], $this->options['pass'], $this->options['db']);if ($this->db->connect_error || @mysqli_connect_error()) {return false;}$this->db->query('SET SESSION character_set_client=utf8');$this->db->query('SET SESSION character_set_connection=utf8');$this->db->query('SET SESSION character_set_results=utf8');$v9b207167e5381c47682c6b4f58a623fb = $this->db->query('SHOW TABLES');if ($v9b207167e5381c47682c6b4f58a623fb) {while ($vf1965a857bc285d26fe22023aa5ab50d = $v9b207167e5381c47682c6b4f58a623fb->fetch_array()) {if ($vf1965a857bc285d26fe22023aa5ab50d[0] == $this->options['files_table']) {$this->tbf = $this->options['files_table'];break;}}}if (!$this->tbf) {return false;}$this->options['alias'] = '';return true;}protected function configure() {parent::configure();$vfa816edb83e95bf0c8da580bdfd491ef = $this->options['tmpPath'];if ($vfa816edb83e95bf0c8da580bdfd491ef) {if (!file_exists($vfa816edb83e95bf0c8da580bdfd491ef)) {if (@mkdir($vfa816edb83e95bf0c8da580bdfd491ef)) {@chmod($vfa816edb83e95bf0c8da580bdfd491ef, $this->options['tmbPathMode']);}}$this->tmpPath = is_dir($vfa816edb83e95bf0c8da580bdfd491ef) && is_writable($vfa816edb83e95bf0c8da580bdfd491ef);}if (!$this->tmpPath && $this->tmbPath && $this->tmbPathWritable) {$this->tmpPath = $this->tmbPath;}if (!$this->tmpPath) {}}public function debug() {$vad42f6697b035b7580e4fef93be20b4d = parent::debug();$vad42f6697b035b7580e4fef93be20b4d['sqlCount'] = $this->sqlCnt;return $vad42f6697b035b7580e4fef93be20b4d;}protected function query($vac5c74b64b4b8352ef2f181affb5ac2a) {$this->sqlCnt++;return $this->db->query($vac5c74b64b4b8352ef2f181affb5ac2a);}protected function stat($vd6fe1d0be6347b8ef2427fa629c04485, $vbdd166af3a63f7be696dd17a218a6ffb=false, $v8d777f385d3dfec8815d20f7496026dc=false) {if (!isset($this->cache[$vd6fe1d0be6347b8ef2427fa629c04485])) {if (!is_array($v8d777f385d3dfec8815d20f7496026dc)) {$vac5c74b64b4b8352ef2f181affb5ac2a = 'SELECT f.id, f.parent_id, f.name, f.size, f.mtime, f.mime, f.width, f.height, ch.id AS dirs
						FROM '.$this->tbf.' AS f 
						LEFT JOIN '.$this->tbf.' AS p ON p.id=f.parent_id
						LEFT JOIN '.$this->tbf.' AS ch ON ch.parent_id=f.id 
						WHERE f.id="'.$vd6fe1d0be6347b8ef2427fa629c04485.'"
						GROUP BY f.id';if ($v9b207167e5381c47682c6b4f58a623fb = $this->query($vac5c74b64b4b8352ef2f181affb5ac2a)) {$v8d777f385d3dfec8815d20f7496026dc = $v9b207167e5381c47682c6b4f58a623fb->fetch_assoc();}}if (!$v8d777f385d3dfec8815d20f7496026dc) {return $this->cache[$vd6fe1d0be6347b8ef2427fa629c04485] = false;}$v8c7dd922ad47494fc02c388e12c00eac = [    'id'        => $v8d777f385d3dfec8815d20f7496026dc['id'],    'parent_id' => $v8d777f385d3dfec8815d20f7496026dc['parent_id'],     'hash'      => $this->encode($v8d777f385d3dfec8815d20f7496026dc['id']),    'phash'     => $v8d777f385d3dfec8815d20f7496026dc['parent_id'] ? $this->encode($v8d777f385d3dfec8815d20f7496026dc['parent_id']) : '',    'name'      => $v8d777f385d3dfec8815d20f7496026dc['name'],    'mime'      => $v8d777f385d3dfec8815d20f7496026dc['mime'],    'size'      => $v8d777f385d3dfec8815d20f7496026dc['size'],    'date'      => $this->formatDate($v8d777f385d3dfec8815d20f7496026dc['mtime'])   ];if (!$v8d777f385d3dfec8815d20f7496026dc['parent_id']) {$v8c7dd922ad47494fc02c388e12c00eac['volumeid'] = $this->id;}if ($v8c7dd922ad47494fc02c388e12c00eac['mime'] == 'directory') {$v8c7dd922ad47494fc02c388e12c00eac['dirs'] = $v8d777f385d3dfec8815d20f7496026dc['dirs'];}else {if ($v8d777f385d3dfec8815d20f7496026dc['width'] && $v8d777f385d3dfec8815d20f7496026dc['height']) {$v8c7dd922ad47494fc02c388e12c00eac['dim'] = $v8d777f385d3dfec8815d20f7496026dc['width'].'x'.$v8d777f385d3dfec8815d20f7496026dc['height'];}if (($va8b687c2e93191d90a6d7b8982ceec4a = $this->gettmb($v8c7dd922ad47494fc02c388e12c00eac['id'])) != false) {$v8c7dd922ad47494fc02c388e12c00eac['tmb'] = $va8b687c2e93191d90a6d7b8982ceec4a;}elseif ($this->canCreateTmb($v8c7dd922ad47494fc02c388e12c00eac['id'], $v8c7dd922ad47494fc02c388e12c00eac['mime'])) {$v8c7dd922ad47494fc02c388e12c00eac['tmb'] = 1;}}if (!isset($this->paths[$v8c7dd922ad47494fc02c388e12c00eac['parent_id']][$v8c7dd922ad47494fc02c388e12c00eac['name']])) {$this->paths[$v8c7dd922ad47494fc02c388e12c00eac['parent_id']][$v8c7dd922ad47494fc02c388e12c00eac['name']] = $v8c7dd922ad47494fc02c388e12c00eac['id'];}$this->cache[$vd6fe1d0be6347b8ef2427fa629c04485] = $v8c7dd922ad47494fc02c388e12c00eac;if ($this->cache[$vd6fe1d0be6347b8ef2427fa629c04485]) {$vb80bb7740288fda1f201890375a60c8f = $this->cache[$vd6fe1d0be6347b8ef2427fa629c04485]['id'];$this->cache[$vd6fe1d0be6347b8ef2427fa629c04485]['read']  = $this->attr($vb80bb7740288fda1f201890375a60c8f, 'read');$this->cache[$vd6fe1d0be6347b8ef2427fa629c04485]['write'] = $this->attr($vb80bb7740288fda1f201890375a60c8f, 'write');if ($this->attr($vb80bb7740288fda1f201890375a60c8f, 'locked')) {$this->cache[$vd6fe1d0be6347b8ef2427fa629c04485]['locked'] = 1;}if ($this->attr($vb80bb7740288fda1f201890375a60c8f, 'hidden')) {$this->cache[$vd6fe1d0be6347b8ef2427fa629c04485]['hidden'] = 1;}}}$v8c7dd922ad47494fc02c388e12c00eac = $this->cache[$vd6fe1d0be6347b8ef2427fa629c04485];if ($v8c7dd922ad47494fc02c388e12c00eac && !$vbdd166af3a63f7be696dd17a218a6ffb) {unset($v8c7dd922ad47494fc02c388e12c00eac['id']);unset($v8c7dd922ad47494fc02c388e12c00eac['parent_id']);}return $v8c7dd922ad47494fc02c388e12c00eac;}protected function clearstat() {$this->cache = [];$this->paths = [];}protected function getParents($vb80bb7740288fda1f201890375a60c8f) {$vc68ad910ed49ac65f21f1bf2c5dbf912 = [];while ($vb80bb7740288fda1f201890375a60c8f > 0) {$v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vb80bb7740288fda1f201890375a60c8f, true);if (!$v8c7dd922ad47494fc02c388e12c00eac) {return [];}$vb80bb7740288fda1f201890375a60c8f = $v8c7dd922ad47494fc02c388e12c00eac['parent_id'];if ($vb80bb7740288fda1f201890375a60c8f > 0) {if (!$this->attr($vb80bb7740288fda1f201890375a60c8f, 'read') || $this->attr($vb80bb7740288fda1f201890375a60c8f, 'hidden')) {return [];}array_unshift($vc68ad910ed49ac65f21f1bf2c5dbf912, $vb80bb7740288fda1f201890375a60c8f);}}return $vc68ad910ed49ac65f21f1bf2c5dbf912;}protected function mimetype($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['mime'] : 'unknown';}protected function _dirname($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485, true)) ? $v8c7dd922ad47494fc02c388e12c00eac['parent_id'] : false;}protected function _joinPath($v736007832d2167baaae763fd3a3f3cf1, $vb068931cc450442b63f5b3d276ea4297) {if (!$this->stat($v736007832d2167baaae763fd3a3f3cf1)) {return -1;}if (!isset($this->paths[$v736007832d2167baaae763fd3a3f3cf1][$vb068931cc450442b63f5b3d276ea4297])) {$this->sqlCnt++;$vac5c74b64b4b8352ef2f181affb5ac2a = 'SELECT id FROM '.$this->tbf.' WHERE parent_id="'.$v736007832d2167baaae763fd3a3f3cf1.'" AND name="'.$this->db->real_escape_string($vb068931cc450442b63f5b3d276ea4297).'"';$v9b207167e5381c47682c6b4f58a623fb = $this->db->query($vac5c74b64b4b8352ef2f181affb5ac2a);if ($v9b207167e5381c47682c6b4f58a623fb) {$v4b43b0aee35624cd95b910189b3dc231 = $v9b207167e5381c47682c6b4f58a623fb->fetch_assoc();if ($v4b43b0aee35624cd95b910189b3dc231) {$this->paths[$v736007832d2167baaae763fd3a3f3cf1][$vb068931cc450442b63f5b3d276ea4297] = $v4b43b0aee35624cd95b910189b3dc231['id'];}}}return isset($this->paths[$v736007832d2167baaae763fd3a3f3cf1][$vb068931cc450442b63f5b3d276ea4297]) ? $this->paths[$v736007832d2167baaae763fd3a3f3cf1][$vb068931cc450442b63f5b3d276ea4297] : -1;}protected function _basename($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['name'] : '';}protected function _normpath($vd6fe1d0be6347b8ef2427fa629c04485) {return $vd6fe1d0be6347b8ef2427fa629c04485;}protected function _relpath($vd6fe1d0be6347b8ef2427fa629c04485) {return $vd6fe1d0be6347b8ef2427fa629c04485;}protected function _abspath($vd6fe1d0be6347b8ef2427fa629c04485) {return $vd6fe1d0be6347b8ef2427fa629c04485;}protected function _path($vd6fe1d0be6347b8ef2427fa629c04485) {if (($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) == false) {return '';}$v0a19308136fd34e2156429d545926bd5 = $this->getParents($vd6fe1d0be6347b8ef2427fa629c04485);$vd6fe1d0be6347b8ef2427fa629c04485 = '';foreach ($v0a19308136fd34e2156429d545926bd5 as $vb80bb7740288fda1f201890375a60c8f) {$v736007832d2167baaae763fd3a3f3cf1 = $this->stat($vb80bb7740288fda1f201890375a60c8f);$vd6fe1d0be6347b8ef2427fa629c04485 .= $v736007832d2167baaae763fd3a3f3cf1['name'].$this->separator;}return $vd6fe1d0be6347b8ef2427fa629c04485.$v8c7dd922ad47494fc02c388e12c00eac['name'];}protected function _inpath($vd6fe1d0be6347b8ef2427fa629c04485, $vd0e45878043844ffc41aac437e86b602) {return $vd6fe1d0be6347b8ef2427fa629c04485 == $vd0e45878043844ffc41aac437e86b602   ? true   : in_array($vd0e45878043844ffc41aac437e86b602, $this->getParents($vd6fe1d0be6347b8ef2427fa629c04485));}protected function _fileExists($vd6fe1d0be6347b8ef2427fa629c04485) {return (bool) $this->stat($vd6fe1d0be6347b8ef2427fa629c04485);}protected function _isDir($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['mime'] == 'directory' : false;}protected function _isFile($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['mime'] != 'directory' : false;}protected function _isLink($vd6fe1d0be6347b8ef2427fa629c04485) {return false;}protected function _isReadable($vd6fe1d0be6347b8ef2427fa629c04485) {return true;}protected function _isWritable($vd6fe1d0be6347b8ef2427fa629c04485) {return true;}protected function _isLocked($vd6fe1d0be6347b8ef2427fa629c04485) {return false;}protected function _isHidden($vd6fe1d0be6347b8ef2427fa629c04485) {return false;}protected function _filesize($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['size'] : false;}protected function _filemtime($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['mtime'] : false;}protected function _subdirs($vd6fe1d0be6347b8ef2427fa629c04485) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['dirs'] : false;}protected function _dimensions($vd6fe1d0be6347b8ef2427fa629c04485, $vd02a169f33469c888396a24dd9d9f1c6) {return ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) ? $v8c7dd922ad47494fc02c388e12c00eac['dim'] : false;}protected function _lstat($vd6fe1d0be6347b8ef2427fa629c04485) {return false;}protected function _readlink($vd6fe1d0be6347b8ef2427fa629c04485) {return false;}protected function _scandir($vb80bb7740288fda1f201890375a60c8f) {$v45b963397aa40d4a0063e0d85e4fe7a1 = [];$vac5c74b64b4b8352ef2f181affb5ac2a   = 'SELECT f.id, f.parent_id, f.name, f.size, f.mtime, f.mime, f.width, f.height, ch.id AS dirs 
				FROM '.$this->tbf.' AS f 
				LEFT JOIN '.$this->tbf.' AS ch ON ch.parent_id=f.id 
				WHERE f.parent_id="'.$vb80bb7740288fda1f201890375a60c8f.'"
				GROUP BY f.id';$v9b207167e5381c47682c6b4f58a623fb = $this->query($vac5c74b64b4b8352ef2f181affb5ac2a);if ($v9b207167e5381c47682c6b4f58a623fb) {while ($v4b43b0aee35624cd95b910189b3dc231 = $v9b207167e5381c47682c6b4f58a623fb->fetch_assoc()) {$vb80bb7740288fda1f201890375a60c8f = $v4b43b0aee35624cd95b910189b3dc231['id'];$this->stat($vb80bb7740288fda1f201890375a60c8f, false, $v4b43b0aee35624cd95b910189b3dc231);$v45b963397aa40d4a0063e0d85e4fe7a1[] = $vb80bb7740288fda1f201890375a60c8f;}}return $v45b963397aa40d4a0063e0d85e4fe7a1;}protected function _fopen($vd6fe1d0be6347b8ef2427fa629c04485, $v15d61712450a686a7f365adf4fef581f='rb') {if ($this->tmpPath && ($v8c7dd922ad47494fc02c388e12c00eac = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485)) && $v8c7dd922ad47494fc02c388e12c00eac['read']) {$vfa816edb83e95bf0c8da580bdfd491ef = $this->tmpPath.DIRECTORY_SEPARATOR.$vd6fe1d0be6347b8ef2427fa629c04485;$v0666f0acdeed38d4cd9084ade1739498 = fopen($vfa816edb83e95bf0c8da580bdfd491ef, 'w');if ($v0666f0acdeed38d4cd9084ade1739498) {$v9b207167e5381c47682c6b4f58a623fb = $this->db->query('SELECT content FROM '.$this->tbf.' WHERE id="'.$vd6fe1d0be6347b8ef2427fa629c04485.'"');if ($v9b207167e5381c47682c6b4f58a623fb) {$v4b43b0aee35624cd95b910189b3dc231 = $v9b207167e5381c47682c6b4f58a623fb->fetch_assoc();if ($v4b43b0aee35624cd95b910189b3dc231) {fwrite($v0666f0acdeed38d4cd9084ade1739498, $v4b43b0aee35624cd95b910189b3dc231['content']);}}fclose($v0666f0acdeed38d4cd9084ade1739498);return fopen($vfa816edb83e95bf0c8da580bdfd491ef, $v15d61712450a686a7f365adf4fef581f);}}return false;}protected function _fclose($v0666f0acdeed38d4cd9084ade1739498, $vd6fe1d0be6347b8ef2427fa629c04485) {@fclose($v0666f0acdeed38d4cd9084ade1739498);if ($vd6fe1d0be6347b8ef2427fa629c04485) {@unlink($this->tmpPath.DIRECTORY_SEPARATOR.$vd6fe1d0be6347b8ef2427fa629c04485);}}protected function _mkdir($vd6fe1d0be6347b8ef2427fa629c04485, $vb068931cc450442b63f5b3d276ea4297) {if (!$this->_isDir($vd6fe1d0be6347b8ef2427fa629c04485)) {return false;}$this->clearstat();$vac5c74b64b4b8352ef2f181affb5ac2a = 'INSERT INTO '.$this->tbf.' (parent_id, name, size, mtime, mime) 
			VALUES ("'.$vd6fe1d0be6347b8ef2427fa629c04485.'", "'.$this->db->real_escape_string($vb068931cc450442b63f5b3d276ea4297).'", 0, '.time().', "directory")';return $this->query($vac5c74b64b4b8352ef2f181affb5ac2a) && $this->db->affected_rows > 0;}protected function _mkfile($vd6fe1d0be6347b8ef2427fa629c04485, $vb068931cc450442b63f5b3d276ea4297) {if (!$this->_isDir($vd6fe1d0be6347b8ef2427fa629c04485)) {return false;}$this->clearstat();$vac5c74b64b4b8352ef2f181affb5ac2a = 'INSERT INTO '.$this->tbf.' (parent_id, name, size, mtime, mime) 
			VALUES ("'.$vd6fe1d0be6347b8ef2427fa629c04485.'", "'.$this->db->real_escape_string($vb068931cc450442b63f5b3d276ea4297).'", 0, '.time().', "text/plain")';return $this->query($vac5c74b64b4b8352ef2f181affb5ac2a) && $this->db->affected_rows > 0;}protected function _symlink($v42aefbae01d2dfd981f7da7d823d689e, $vd6fe1d0be6347b8ef2427fa629c04485, $vb068931cc450442b63f5b3d276ea4297='') {return false;}protected function _copy($v36cd38f49b9afa08222c0dc9ebfe35eb, $v1baf8770b1d8a6e742d5e7d6d241e5d2, $vb068931cc450442b63f5b3d276ea4297='') {if (!$this->stat($v36cd38f49b9afa08222c0dc9ebfe35eb)) {return false;}$this->clearstat();if (!$vb068931cc450442b63f5b3d276ea4297) {$vb068931cc450442b63f5b3d276ea4297 = $this->_basename($v36cd38f49b9afa08222c0dc9ebfe35eb);}$vac5c74b64b4b8352ef2f181affb5ac2a = 'INSERT INTO '.$this->tbf.' (parent_id, name, content, size, mtime, mime, width, height)  '    .'SELECT "'. (int) $v1baf8770b1d8a6e742d5e7d6d241e5d2 .'", "'.$this->db->real_escape_string($vb068931cc450442b63f5b3d276ea4297).'", content, size, "'.time().'", mime, width, height FROM '.$this->tbf.' WHERE id="'. (int) $v36cd38f49b9afa08222c0dc9ebfe35eb .'"';return $this->query($vac5c74b64b4b8352ef2f181affb5ac2a) && $this->db->affected_rows;}protected function _move($v36cd38f49b9afa08222c0dc9ebfe35eb, $v1baf8770b1d8a6e742d5e7d6d241e5d2, $vb068931cc450442b63f5b3d276ea4297='') {if (!$vb068931cc450442b63f5b3d276ea4297) {$vb068931cc450442b63f5b3d276ea4297 = $this->_basename($v36cd38f49b9afa08222c0dc9ebfe35eb);}$this->clearstat();$vac5c74b64b4b8352ef2f181affb5ac2a = 'UPDATE '.$this->tbf.' SET parent_id="'.$this->_dirname($v36cd38f49b9afa08222c0dc9ebfe35eb).'", name="'.$this->db->real_escape_string($vb068931cc450442b63f5b3d276ea4297).'", mtime="'.time().'" WHERE id="'. (int) $v36cd38f49b9afa08222c0dc9ebfe35eb .'"';return $this->query($vac5c74b64b4b8352ef2f181affb5ac2a) && $this->db->affected_rows;}protected function _unlink($vd6fe1d0be6347b8ef2427fa629c04485) {$this->clearstat();$vac5c74b64b4b8352ef2f181affb5ac2a = 'DELETE FROM '.$this->tbf.' WHERE id="'. (int) $vd6fe1d0be6347b8ef2427fa629c04485 .'" AND mime!="directory" LIMIT 1';return $this->query($vac5c74b64b4b8352ef2f181affb5ac2a) && $this->db->affected_rows > 0;}protected function _rmdir($vd6fe1d0be6347b8ef2427fa629c04485) {$this->clearstat();$vac5c74b64b4b8352ef2f181affb5ac2a = 'SELECT COUNT(f.id) AS num FROM '.$this->tbf.' WHERE parent_id="'. (int) $vd6fe1d0be6347b8ef2427fa629c04485 .'" GROUP BY f.parent_id';$v9b207167e5381c47682c6b4f58a623fb = $this->query($vac5c74b64b4b8352ef2f181affb5ac2a);if ($v9b207167e5381c47682c6b4f58a623fb) {$v4b43b0aee35624cd95b910189b3dc231 = $v9b207167e5381c47682c6b4f58a623fb->fetch_assoc();if ($v4b43b0aee35624cd95b910189b3dc231) {if ($v4b43b0aee35624cd95b910189b3dc231['num'] > 0) {return false;}}}$vac5c74b64b4b8352ef2f181affb5ac2a = 'DELETE FROM '.$this->tbf.' WHERE id="'. (int) $vd6fe1d0be6347b8ef2427fa629c04485 .'" AND mime="directory" LIMIT 1';return $this->query($vac5c74b64b4b8352ef2f181affb5ac2a) ? $this->db->affected_rows > 0 : false;}protected function _save($v0666f0acdeed38d4cd9084ade1739498, $v736007832d2167baaae763fd3a3f3cf1, $vb068931cc450442b63f5b3d276ea4297) {$this->clearstat();$vb80bb7740288fda1f201890375a60c8f = $this->_joinPath($v736007832d2167baaae763fd3a3f3cf1, $vb068931cc450442b63f5b3d276ea4297);if ($this->tmpPath) {$vfa816edb83e95bf0c8da580bdfd491ef = $this->tmpPath.DIRECTORY_SEPARATOR.$vb068931cc450442b63f5b3d276ea4297;if (!($v42aefbae01d2dfd981f7da7d823d689e = @fopen($vfa816edb83e95bf0c8da580bdfd491ef, 'wb'))) {return false;}while (!feof($v0666f0acdeed38d4cd9084ade1739498)) {fwrite($v42aefbae01d2dfd981f7da7d823d689e, fread($v0666f0acdeed38d4cd9084ade1739498, 8192));}fclose($v42aefbae01d2dfd981f7da7d823d689e);$vd02a169f33469c888396a24dd9d9f1c6  = parent::mimetype($vfa816edb83e95bf0c8da580bdfd491ef);$veaae26a6fb20ed3ef54fb23bfa0b1fcc = $vb435e227d5dd201e1768b2bcb2e0aa81 = 0;if (mb_strpos($vd02a169f33469c888396a24dd9d9f1c6, 'image') === 0) {if ($v03c7c0ace395d80182db07ae2c30f034 = getimagesize($vfa816edb83e95bf0c8da580bdfd491ef)) {$veaae26a6fb20ed3ef54fb23bfa0b1fcc  = $v03c7c0ace395d80182db07ae2c30f034[0];$vb435e227d5dd201e1768b2bcb2e0aa81 = $v03c7c0ace395d80182db07ae2c30f034[1];}}$vac5c74b64b4b8352ef2f181affb5ac2a = $vb80bb7740288fda1f201890375a60c8f > 0    ? 'REPLACE INTO %s (id, parent_id, name, content, size, mtime, mime, width, height) VALUES ('.$vb80bb7740288fda1f201890375a60c8f.', %d, "%s", LOAD_FILE("%s"), %d, %d, "%s", %d, %d)'    : 'INSERT INTO %s (parent_id, name, content, size, mtime, mime, width, height) VALUES (%d, "%s", LOAD_FILE("%s"), %d, %d, "%s", %d, %d)';$vac5c74b64b4b8352ef2f181affb5ac2a = sprintf($vac5c74b64b4b8352ef2f181affb5ac2a, $this->tbf, $v736007832d2167baaae763fd3a3f3cf1, $this->db->real_escape_string($vb068931cc450442b63f5b3d276ea4297), realpath($vfa816edb83e95bf0c8da580bdfd491ef), filesize($vfa816edb83e95bf0c8da580bdfd491ef), time(), $vd02a169f33469c888396a24dd9d9f1c6, $veaae26a6fb20ed3ef54fb23bfa0b1fcc, $vb435e227d5dd201e1768b2bcb2e0aa81);}else {$this->mimeDetect = 'internal';$vd02a169f33469c888396a24dd9d9f1c6 = parent::mimetype($vb068931cc450442b63f5b3d276ea4297);$v77ddcb5f19832f4145345889013ab3a4 = fstat($v0666f0acdeed38d4cd9084ade1739498);$vf7bd60b75b29d79b660a2859395c1a24 = $v77ddcb5f19832f4145345889013ab3a4['size'];$v9a0364b9e99bb480dd25e1f0284c8555 = '';while (!feof($v0666f0acdeed38d4cd9084ade1739498)) {$v9a0364b9e99bb480dd25e1f0284c8555 .= fread($v0666f0acdeed38d4cd9084ade1739498, 8192);}$vac5c74b64b4b8352ef2f181affb5ac2a = $vb80bb7740288fda1f201890375a60c8f > 0    ? 'REPLACE INTO %s (id, parent_id, name, content, size, mtime, mime, width, height) VALUES ('.$vb80bb7740288fda1f201890375a60c8f.', %d, "%s", "%s", %d, %d, "%s", %d, %d)'    : 'INSERT INTO %s (parent_id, name, content, size, mtime, mime, width, height) VALUES (%d, "%s", "%s", %d, %d, "%s", %d, %d)';$vac5c74b64b4b8352ef2f181affb5ac2a = sprintf($vac5c74b64b4b8352ef2f181affb5ac2a, $this->tbf, $v736007832d2167baaae763fd3a3f3cf1, $this->db->real_escape_string($vb068931cc450442b63f5b3d276ea4297), '0x' . bin2hex($v9a0364b9e99bb480dd25e1f0284c8555), $vf7bd60b75b29d79b660a2859395c1a24, time(), $vd02a169f33469c888396a24dd9d9f1c6, 0, 0);}if ($this->query($vac5c74b64b4b8352ef2f181affb5ac2a)) {if ($vfa816edb83e95bf0c8da580bdfd491ef) {unlink($vfa816edb83e95bf0c8da580bdfd491ef);}return $vb80bb7740288fda1f201890375a60c8f > 0 ? $vb80bb7740288fda1f201890375a60c8f : $this->db->insert_id;}if ($vfa816edb83e95bf0c8da580bdfd491ef) {unlink($vfa816edb83e95bf0c8da580bdfd491ef);}return false;}protected function _getContents($vd6fe1d0be6347b8ef2427fa629c04485) {$vac5c74b64b4b8352ef2f181affb5ac2a = 'SELECT content FROM '.$this->tbf.' WHERE id='. (int) $vd6fe1d0be6347b8ef2427fa629c04485;$v9b207167e5381c47682c6b4f58a623fb = $this->query($vac5c74b64b4b8352ef2f181affb5ac2a);if ($v9b207167e5381c47682c6b4f58a623fb) {$v4b43b0aee35624cd95b910189b3dc231 = $v9b207167e5381c47682c6b4f58a623fb->fetch_assoc();if ($v4b43b0aee35624cd95b910189b3dc231) {return $v4b43b0aee35624cd95b910189b3dc231['content'];}}return false;}protected function _filePutContents($vd6fe1d0be6347b8ef2427fa629c04485, $v9a0364b9e99bb480dd25e1f0284c8555) {$vac5c74b64b4b8352ef2f181affb5ac2a = 'UPDATE '.$this->tbf.' SET content="'.$this->db->real_escape_string($v9a0364b9e99bb480dd25e1f0284c8555).'", size="'.mb_strlen($v9a0364b9e99bb480dd25e1f0284c8555).'", mtime="'.time().'" WHERE id='. (int) $vd6fe1d0be6347b8ef2427fa629c04485;if ($this->query($vac5c74b64b4b8352ef2f181affb5ac2a)) {$this->clearstat();return true;}return false;}protected function _extract($vd6fe1d0be6347b8ef2427fa629c04485, $v909ba4ad2bda46b10aac3c5b7f01abd5) {return false;}protected function _archive($v736007832d2167baaae763fd3a3f3cf1, $v45b963397aa40d4a0063e0d85e4fe7a1, $vb068931cc450442b63f5b3d276ea4297, $v909ba4ad2bda46b10aac3c5b7f01abd5) {return false;}protected function _checkArchivers() {return [];}}