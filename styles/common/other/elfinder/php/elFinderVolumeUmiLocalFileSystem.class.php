<?php
 class elFinderVolumeUmiLocalFileSystem extends elFinderVolumeLocalFileSystem {protected $driverId = 'umi';public function fullRoot() {return $this->root;}public function rename($v0800fc577294c34e0b28ad2839435945, $vb068931cc450442b63f5b3d276ea4297) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->decode($v0800fc577294c34e0b28ad2839435945);if (!($v8c7dd922ad47494fc02c388e12c00eac = $this->file($v0800fc577294c34e0b28ad2839435945))) {return $this->setError(elFinder::ERROR_FILE_NOT_FOUND);}$v736007832d2167baaae763fd3a3f3cf1 = $this->_dirname($vd6fe1d0be6347b8ef2427fa629c04485);if ($this->attr($vd6fe1d0be6347b8ef2427fa629c04485, 'locked')) {return $this->setError(elFinder::ERROR_LOCKED, $v8c7dd922ad47494fc02c388e12c00eac['name']);}if (!$this->nameAccepted($vb068931cc450442b63f5b3d276ea4297)) {return $this->setError(elFinder::ERROR_INVALID_NAME, $vb068931cc450442b63f5b3d276ea4297);}if ($vb068931cc450442b63f5b3d276ea4297 == $v8c7dd922ad47494fc02c388e12c00eac['name']) {return $v8c7dd922ad47494fc02c388e12c00eac;}$vfef94e17b0a578c288d87f42bf6f3814 = mb_strrpos($vb068931cc450442b63f5b3d276ea4297, '.');$v6843546ef893a560f0235cd96327ad08 = $vfef94e17b0a578c288d87f42bf6f3814 ? mb_substr($vb068931cc450442b63f5b3d276ea4297, mb_strrpos($vb068931cc450442b63f5b3d276ea4297, '.')) : '';$ve92235cfbbcdffc6064f23266dfc15ca = mb_strrpos($v8c7dd922ad47494fc02c388e12c00eac['name'], '.');$vabf77184f55403d75b9d51d79162a7ca = $ve92235cfbbcdffc6064f23266dfc15ca ? mb_substr($v8c7dd922ad47494fc02c388e12c00eac['name'], mb_strrpos($v8c7dd922ad47494fc02c388e12c00eac['name'], '.')) : '';if ($v6843546ef893a560f0235cd96327ad08 != $vabf77184f55403d75b9d51d79162a7ca) {return $this->setError(elFinder::ERROR_INVALID_NAME, $vb068931cc450442b63f5b3d276ea4297);}if ($this->_moveWithRename($vd6fe1d0be6347b8ef2427fa629c04485, $v736007832d2167baaae763fd3a3f3cf1, $vb068931cc450442b63f5b3d276ea4297)) {$this->rmTmb($vd6fe1d0be6347b8ef2427fa629c04485);return $this->stat($this->_joinPath($v736007832d2167baaae763fd3a3f3cf1, $vb068931cc450442b63f5b3d276ea4297));}return false;}public function duplicate($v0800fc577294c34e0b28ad2839435945) {if (($v8c7dd922ad47494fc02c388e12c00eac = $this->file($v0800fc577294c34e0b28ad2839435945)) == false) {return $this->setError(elFinder::ERROR_FILE_NOT_FOUND);}$vd6fe1d0be6347b8ef2427fa629c04485 = $this->decode($v0800fc577294c34e0b28ad2839435945);$v736007832d2167baaae763fd3a3f3cf1  = $this->_dirname($vd6fe1d0be6347b8ef2427fa629c04485);return ($vd6fe1d0be6347b8ef2427fa629c04485 = $this->doCopy($vd6fe1d0be6347b8ef2427fa629c04485, $v736007832d2167baaae763fd3a3f3cf1, $this->uniqueName($v736007832d2167baaae763fd3a3f3cf1, $v8c7dd922ad47494fc02c388e12c00eac['name'], '_copy'))) == false    ? false    : $this->stat($vd6fe1d0be6347b8ef2427fa629c04485);}public function mkdir($v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297, $v12cba3ee81cf4a793796a51b6327c678=false) {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->decode($v28e3d688a3c077b887921cea3fb1dbc7);if (($v736007832d2167baaae763fd3a3f3cf1 = $this->dir($v28e3d688a3c077b887921cea3fb1dbc7)) == false) {return $this->setError(elFinder::ERROR_TRGDIR_NOT_FOUND, '#'.$v28e3d688a3c077b887921cea3fb1dbc7);}if (!$v736007832d2167baaae763fd3a3f3cf1['write']) {return $this->setError(elFinder::ERROR_PERM_DENIED);}if (!$this->nameAccepted($vb068931cc450442b63f5b3d276ea4297)) {return $this->setError(elFinder::ERROR_INVALID_NAME);}if ($v12cba3ee81cf4a793796a51b6327c678 && !$this->options['copyOverwrite']) {$vb068931cc450442b63f5b3d276ea4297 = $this->uniqueName($vd6fe1d0be6347b8ef2427fa629c04485, $vb068931cc450442b63f5b3d276ea4297, '-', false);}$v28e3d688a3c077b887921cea3fb1dbc7 = $this->_joinPath($vd6fe1d0be6347b8ef2427fa629c04485, $vb068931cc450442b63f5b3d276ea4297);if ($this->_fileExists($v28e3d688a3c077b887921cea3fb1dbc7)) {if ($v12cba3ee81cf4a793796a51b6327c678) {if (!$this->options['copyJoin'] && $this->attr($v28e3d688a3c077b887921cea3fb1dbc7, 'write')) {foreach ($this->_scandir($v28e3d688a3c077b887921cea3fb1dbc7) as $v83878c91171338902e0fe0fb97a8c47a) {$this->doRm($v83878c91171338902e0fe0fb97a8c47a);}}return $this->stat($v28e3d688a3c077b887921cea3fb1dbc7);}return $this->setError(elFinder::ERROR_EXISTS, $vb068931cc450442b63f5b3d276ea4297);}return $this->_mkdirWithRename($vd6fe1d0be6347b8ef2427fa629c04485, $vb068931cc450442b63f5b3d276ea4297) ? $this->stat($this->_joinPath($vd6fe1d0be6347b8ef2427fa629c04485, $vb068931cc450442b63f5b3d276ea4297)) : false;}public function save($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297, $vdfff0a7fa1a55c8c1a4966c19f6da452 = 'upload') {if (($v736007832d2167baaae763fd3a3f3cf1 = $this->dir($v28e3d688a3c077b887921cea3fb1dbc7, true, true)) == false) {return $this->setError(elFinder::ERROR_TRGDIR_NOT_FOUND, '#'.$v28e3d688a3c077b887921cea3fb1dbc7);}if (!$v736007832d2167baaae763fd3a3f3cf1['write']) {return $this->setError(elFinder::ERROR_PERM_DENIED);}if (!$this->nameAccepted($vb068931cc450442b63f5b3d276ea4297)) {return $this->setError(elFinder::ERROR_INVALID_NAME, $vb068931cc450442b63f5b3d276ea4297);}$v28e3d688a3c077b887921cea3fb1dbc7 = $this->decode($v28e3d688a3c077b887921cea3fb1dbc7);if (mb_strpos($v28e3d688a3c077b887921cea3fb1dbc7, USER_FILES_PATH ) !== false || mb_strpos($v28e3d688a3c077b887921cea3fb1dbc7, USER_IMAGES_PATH) !== false) {$v7079797cf8751efb52c390933238e7a8 = getBytesFromString( mainConfiguration::getInstance()->get('system', 'quota-files-and-images') );if ( $v7079797cf8751efb52c390933238e7a8 != 0 ) {$v27fe800121fd9e812c6905f3bc8937dd = getBusyDiskSize();if ( $v27fe800121fd9e812c6905f3bc8937dd >= $v7079797cf8751efb52c390933238e7a8 ) {return $this->setError(getLabel('error-files_quota_exceeded'));}}}$vc981ba9b125236385735528b5817ebf5 = method_exists($this, "_doSave_{$vdfff0a7fa1a55c8c1a4966c19f6da452}") ? "_doSave_{$vdfff0a7fa1a55c8c1a4966c19f6da452}" : '_doSave_unknown';$vd6fe1d0be6347b8ef2427fa629c04485 = $this->$vc981ba9b125236385735528b5817ebf5($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297);$result = false;if ($vd6fe1d0be6347b8ef2427fa629c04485) {$result = $this->stat($vd6fe1d0be6347b8ef2427fa629c04485);}return $result;}private function restoreLocale($v6cd1fc8a9f068c091a11490232cee301) {$v65780d59185a11f7ed4ef2a9beacdc6d = explode(';', $v6cd1fc8a9f068c091a11490232cee301);foreach($v65780d59185a11f7ed4ef2a9beacdc6d as $v3bdf246674c54bc3c2f3dc2247780278) {if (mb_strpos($v3bdf246674c54bc3c2f3dc2247780278, '=') !== false) {list($vc4ef352f74e502ef5e7bc98e6f4e493d, $vfb216d9e8791e63c8d12bdc420956839) = explode('=', $v3bdf246674c54bc3c2f3dc2247780278);}else {$vc4ef352f74e502ef5e7bc98e6f4e493d = LC_ALL;$vfb216d9e8791e63c8d12bdc420956839 = $v3bdf246674c54bc3c2f3dc2247780278;}setlocale($vc4ef352f74e502ef5e7bc98e6f4e493d, $vfb216d9e8791e63c8d12bdc420956839);}}protected function _moveWithRename($v36cd38f49b9afa08222c0dc9ebfe35eb, &$v1baf8770b1d8a6e742d5e7d6d241e5d2, &$vb068931cc450442b63f5b3d276ea4297='') {$v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v91c6795f668304672929c7b00b93cd33 = true;$vd9cc16540e5d8b2a6768f9e155e13eff = setlocale(LC_ALL, NULL);setlocale(LC_ALL, ['ru_RU.UTF-8', 'ru_RU.CP1251', 'ru_RU.KOI8-R', 'ru_SU.CP1251', 'ru_RU', 'russian', 'ru_SU', 'ru']);while($v91c6795f668304672929c7b00b93cd33) {$vb068931cc450442b63f5b3d276ea4297 = $this->_getNewFilename($vb068931cc450442b63f5b3d276ea4297, $v865c0c0b4ab0e063e5caa3387c1a8741);$v42aefbae01d2dfd981f7da7d823d689e = $v1baf8770b1d8a6e742d5e7d6d241e5d2 . DIRECTORY_SEPARATOR . ($vb068931cc450442b63f5b3d276ea4297 ?: basename($v36cd38f49b9afa08222c0dc9ebfe35eb));clearstatcache();$v91c6795f668304672929c7b00b93cd33 = (file_exists($v42aefbae01d2dfd981f7da7d823d689e) || is_dir($v42aefbae01d2dfd981f7da7d823d689e));$v865c0c0b4ab0e063e5caa3387c1a8741++;}$this->restoreLocale($vd9cc16540e5d8b2a6768f9e155e13eff);return @rename($v36cd38f49b9afa08222c0dc9ebfe35eb, $v42aefbae01d2dfd981f7da7d823d689e);}protected function _mkdirWithRename($vd6fe1d0be6347b8ef2427fa629c04485, &$vb068931cc450442b63f5b3d276ea4297) {$v865c0c0b4ab0e063e5caa3387c1a8741 = 0;$v91c6795f668304672929c7b00b93cd33 = true;$vd9cc16540e5d8b2a6768f9e155e13eff = setlocale(LC_ALL, NULL);setlocale(LC_ALL, ['ru_RU.UTF-8', 'ru_RU.CP1251', 'ru_RU.KOI8-R', 'ru_SU.CP1251', 'ru_RU', 'russian', 'ru_SU', 'ru']);while($v91c6795f668304672929c7b00b93cd33) {$vb068931cc450442b63f5b3d276ea4297 = $this->_getNewFilename($vb068931cc450442b63f5b3d276ea4297, $v865c0c0b4ab0e063e5caa3387c1a8741);$v42aefbae01d2dfd981f7da7d823d689e = $vd6fe1d0be6347b8ef2427fa629c04485.DIRECTORY_SEPARATOR.$vb068931cc450442b63f5b3d276ea4297;clearstatcache();$v91c6795f668304672929c7b00b93cd33 = (file_exists($v42aefbae01d2dfd981f7da7d823d689e) || is_dir($v42aefbae01d2dfd981f7da7d823d689e));$v865c0c0b4ab0e063e5caa3387c1a8741++;}$this->restoreLocale($vd9cc16540e5d8b2a6768f9e155e13eff);if (@mkdir($v42aefbae01d2dfd981f7da7d823d689e)) {@chmod($v42aefbae01d2dfd981f7da7d823d689e, $this->options['dirMode']);return true;}return false;}protected function _getNewFilename($v80cb0f87434e7d1a8fb75106b8b6aa9c, $v865c0c0b4ab0e063e5caa3387c1a8741) {if($v80cb0f87434e7d1a8fb75106b8b6aa9c == '') {return $v80cb0f87434e7d1a8fb75106b8b6aa9c;}$v048a5d9ff9cf7f7c9258b82075473585 = mb_strrpos($v80cb0f87434e7d1a8fb75106b8b6aa9c, '.');$v33d1ae3aef5ddc2f5717e8f4856a5797 = $v048a5d9ff9cf7f7c9258b82075473585 ? mb_substr($v80cb0f87434e7d1a8fb75106b8b6aa9c, 0, mb_strrpos($v80cb0f87434e7d1a8fb75106b8b6aa9c, '.')) : $v80cb0f87434e7d1a8fb75106b8b6aa9c;$v33d1ae3aef5ddc2f5717e8f4856a5797 = $this->_convertFilename($v33d1ae3aef5ddc2f5717e8f4856a5797);$v3cc3cfd0a62f38145783ef77e19a0610 = $v048a5d9ff9cf7f7c9258b82075473585 ? mb_substr($v80cb0f87434e7d1a8fb75106b8b6aa9c, mb_strrpos($v80cb0f87434e7d1a8fb75106b8b6aa9c, '.')) : '';$v3cc3cfd0a62f38145783ef77e19a0610 = $this->_convertFilename($v3cc3cfd0a62f38145783ef77e19a0610);if($v865c0c0b4ab0e063e5caa3387c1a8741 == 0) {return "{$v33d1ae3aef5ddc2f5717e8f4856a5797}{$v3cc3cfd0a62f38145783ef77e19a0610}";}return "{$v33d1ae3aef5ddc2f5717e8f4856a5797}_{$v865c0c0b4ab0e063e5caa3387c1a8741}{$v3cc3cfd0a62f38145783ef77e19a0610}";}protected function _checkArchivers() {return $this->options['archivers'] = $this->options['archive'] = [];}protected function _convertFilename($v935e2a8ccaeae38ebeb8e942247dd54d) {$v20e8bd4a2f8d5970a57207d9709fa13f = [    ['a', ['а', 'А']], ['b', ['б', 'Б']], ['v', ['в', 'В']],    ['g', ['г', 'Г']], ['d', ['д', 'Д']], ['e', ['е', 'Е']],    ['e', ['ё', 'Ё']], ['zsh', ['ж', 'Ж']], ['z', ['з', 'З']],    ['i', ['и', 'И']], ['i', ['й', 'Й']], ['k', ['к', 'К']],    ['l', ['л', 'Л']], ['m', ['м', 'М']], ['n', ['н', 'Н']],    ['o', ['о', 'О']], ['p', ['п', 'П']], ['r', ['р', 'Р']],    ['s', ['с', 'С']], ['t', ['т', 'Т']], ['u', ['у', 'У']],    ['f', ['ф', 'Ф']], ['h', ['х', 'Х']], ['c', ['ц', 'Ц']],    ['ch', ['ч', 'Ч']], ['sh', ['ш', 'Ш']], ['sh', ['щ', 'Щ']],    ['', ['ъ', 'Ъ']], ['i', ['ы', 'Ы']], ['', ['ь', 'Ь']],    ['e', ['э', 'Э']], ['yu', ['ю', 'Ю']], ['ya', ['я', 'Я']],    ['_', ' '], ['', '~'], ['', '`'],    ['', '!'], ['', '@'], ['', '"'],    ['', "'"], ['', '#'], ['', '№'],    ['', '$'], ['', ';'], ['', '%'],    ['', '^'], ['', ':'], ['', '&'],    ['', '?'], ['', '*'], ['', '+'],    ['', '='], ['', '|'], ['', "\\"],    ['', '/'], ['', ','], ['', '<'],    ['', '>']   ];foreach($v20e8bd4a2f8d5970a57207d9709fa13f as $v7d092c708e1d0264d22a9231cc5b49b9) {$v935e2a8ccaeae38ebeb8e942247dd54d = str_replace($v7d092c708e1d0264d22a9231cc5b49b9[1], $v7d092c708e1d0264d22a9231cc5b49b9[0], $v935e2a8ccaeae38ebeb8e942247dd54d);}return $v935e2a8ccaeae38ebeb8e942247dd54d;}protected function _doSave_upload($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297) {$v109633366fd0d46d371ede589998abaa = getcwd();chdir(CURRENT_WORKING_DIR);$v4bd19a884f07e6a2211760e682f98588 = 0;$v594c103f2c6e04c3d8ab059f031e0c1a = cmsController::getInstance();$v435ed7e9f07f740abf511a62c00eef6e = '.' . rtrim($v28e3d688a3c077b887921cea3fb1dbc7, "/\\") . DIRECTORY_SEPARATOR . $vb068931cc450442b63f5b3d276ea4297;if(isset($_FILES['upload'])) {foreach($_FILES['upload']['name'] as $v865c0c0b4ab0e063e5caa3387c1a8741 => $v1cf7e4c33df66ca3d5459264ea9a5885) {if($v1cf7e4c33df66ca3d5459264ea9a5885 == $vb068931cc450442b63f5b3d276ea4297) {$v435ed7e9f07f740abf511a62c00eef6e = $_FILES['upload']['tmp_name'][$v865c0c0b4ab0e063e5caa3387c1a8741];$v4bd19a884f07e6a2211760e682f98588 = $v865c0c0b4ab0e063e5caa3387c1a8741;}}}$v11b4278c7e5a79003db77272c1ed2cf5 = (int) filesize($v435ed7e9f07f740abf511a62c00eef6e);if (umiImageFile::getIsImage($vb068931cc450442b63f5b3d276ea4297)) {$ve6a7ab42343e8bc9131d89646abcb773 = $v594c103f2c6e04c3d8ab059f031e0c1a->getModule('data')->getAllowedMaxFileSize('img') * 1024 * 1024;if ($ve6a7ab42343e8bc9131d89646abcb773 > 0) {if ($ve6a7ab42343e8bc9131d89646abcb773 < $v11b4278c7e5a79003db77272c1ed2cf5) {chdir($v109633366fd0d46d371ede589998abaa);return $this->setError(getLabel('error-max_img_filesize') . ' ' . ($ve6a7ab42343e8bc9131d89646abcb773 / 1024 / 1024) . 'M');}}if(getRequest('water_mark')) {umiImageFile::setWatermarkOn();}$v8c7dd922ad47494fc02c388e12c00eac = umiImageFile::upload('upload', $v4bd19a884f07e6a2211760e682f98588, $v28e3d688a3c077b887921cea3fb1dbc7);}else {$v79001f389eb5f5185f6945430cb57be1 = $v594c103f2c6e04c3d8ab059f031e0c1a->getModule('data')->getAllowedMaxFileSize() * 1024 * 1024;if ($v79001f389eb5f5185f6945430cb57be1 > 0) {if ($v79001f389eb5f5185f6945430cb57be1 < $v11b4278c7e5a79003db77272c1ed2cf5) {chdir($v109633366fd0d46d371ede589998abaa);return $this->setError(getLabel('error-max_filesize') . ' ' . ($v79001f389eb5f5185f6945430cb57be1 / 1024 / 1024) . 'M');}}$v8c7dd922ad47494fc02c388e12c00eac = umiFile::upload('upload', $v4bd19a884f07e6a2211760e682f98588, $v28e3d688a3c077b887921cea3fb1dbc7);}chdir($v109633366fd0d46d371ede589998abaa);if(!$v8c7dd922ad47494fc02c388e12c00eac instanceof umiFile || $v8c7dd922ad47494fc02c388e12c00eac->getIsBroken()) {return $this->setError(elFinder::ERROR_UPLOAD);}return CURRENT_WORKING_DIR . $v8c7dd922ad47494fc02c388e12c00eac->getFilePath(true);}protected function _doSave_copy($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297) {$vd6fe1d0be6347b8ef2427fa629c04485 = $v28e3d688a3c077b887921cea3fb1dbc7.DIRECTORY_SEPARATOR.$vb068931cc450442b63f5b3d276ea4297;if (!($v42aefbae01d2dfd981f7da7d823d689e = @fopen($vd6fe1d0be6347b8ef2427fa629c04485, 'wb'))) {$this->setError(elFinder::ERROR_COPY);return false;}while (!feof($v0666f0acdeed38d4cd9084ade1739498)) {fwrite($v42aefbae01d2dfd981f7da7d823d689e, fread($v0666f0acdeed38d4cd9084ade1739498, 8192));}fclose($v42aefbae01d2dfd981f7da7d823d689e);@chmod($vd6fe1d0be6347b8ef2427fa629c04485, $this->options['fileMode']);clearstatcache();return $vd6fe1d0be6347b8ef2427fa629c04485;}protected function _doSave_unknown($v0666f0acdeed38d4cd9084ade1739498, $v28e3d688a3c077b887921cea3fb1dbc7, $vb068931cc450442b63f5b3d276ea4297) {return $this->setError(elFinder::ERROR_UNKNOWN_CMD);}protected function procExec($v1dccadfed7bcbb036c56a4afb97e906f , array &$v78e6221f6393d1356681db398f14ce6d = null, &$v932c58e78652ca7c730af735468da0a4 = -1, array &$v098547e3fef7aa7f24e9ecb5a5e39663 = null) {$v6e698426544e05ea09d339c3f40ef765 = [    0 => ['pipe', 'r'],  1 => ['pipe', 'w'],  2 => ['pipe', 'w'] ];$v5075140835d0bc504791c76b04c33d2b = proc_open($v1dccadfed7bcbb036c56a4afb97e906f, $v6e698426544e05ea09d339c3f40ef765, $v24a9384d408f3fa1654c08dfaea45dd3) or false;if (is_resource($v5075140835d0bc504791c76b04c33d2b)) {fclose($v24a9384d408f3fa1654c08dfaea45dd3[0]);$v2eaeb6848d027296afcc1e15176f4c74 = '';$vd67e3bf4505c10e91ca24a3b69bf2e79 = '';if( !feof( $v24a9384d408f3fa1654c08dfaea45dd3[1] ) ) {$v78e6221f6393d1356681db398f14ce6d[] = fgets($v24a9384d408f3fa1654c08dfaea45dd3[1], 1024);}if( !feof( $v24a9384d408f3fa1654c08dfaea45dd3[2] ) ) {$v098547e3fef7aa7f24e9ecb5a5e39663[] = fgets($v24a9384d408f3fa1654c08dfaea45dd3[2], 1024);}fclose($v24a9384d408f3fa1654c08dfaea45dd3[1]);fclose($v24a9384d408f3fa1654c08dfaea45dd3[2]);$v932c58e78652ca7c730af735468da0a4 = proc_close($v5075140835d0bc504791c76b04c33d2b);}return $v932c58e78652ca7c730af735468da0a4;}protected function _abspath($vd6fe1d0be6347b8ef2427fa629c04485) {$vd6fe1d0be6347b8ef2427fa629c04485 = preg_replace('/(\.\.\/?)/i', '', $vd6fe1d0be6347b8ef2427fa629c04485);return ($vd6fe1d0be6347b8ef2427fa629c04485 == DIRECTORY_SEPARATOR) ? $this->root : $this->root . DIRECTORY_SEPARATOR . $vd6fe1d0be6347b8ef2427fa629c04485;}}